# Lecture 01 - Kubernetes fundaments

## Introduction to the instructors

### Nicklas Marc Pedersen

- 9th semester Software Engineering student
- Writing Master's thesis with Jakob as my supervisor
- Been instructor / supervisor for different courses
  - Instructor in Operating Systems and Distributed Systems for 3th semester Software Engineering
  - Supervisor in semester projects for 2nd and 3th semester Software Engineering

### Anders Launer Bæk-Petersen

![Anders Launer Bæk-Petersen](https://avatars.githubusercontent.com/u/28479232?v=4)
- PhD Fellow ~ Center for Energy Informatics University of Southern Denmark
    - Transferable AI Model Development Framework for Smart Energy Systems
- Industry for 4,5 years
    - Machine Learning Engineer ~ Energinet
    - Data Scientist ~ Esoft R&D
    - Research Assistant ~ Technical University of Denmark
- Master of Science in Mathematical Modelling and Computation ~ Technical University of Denmark 
- Bachelor of Science in Robot Systems ~ University of Southern Denmark 
- LinkedIn ~ [linkedin.com/in/anderslaunerbaek](https://www.linkedin.com/in/anderslaunerbaek/)

## Subject and objective for these exercises

The exercises for the first lecture are to introduce and refresh the necessary components and terminology of Kubernetes. The below-mentioned material has been sourced from [https://kubernetes.io/docs/tutorials/kubernetes-basics](https://kubernetes.io/docs/tutorials/kubernetes-basics/) and familiarizing with this content will be sufficient for progressing along the exercises. 

The objective of this lecture is to provide the foundation for future exercise sessions and for the semester project.


## Brief introduction to Kubernetes

Kubernetes was one of the answers to moving from pure virtualization towards infrastructure as a service and being the convenient abstraction for decoupling applications and the underlying hardware.

We recommend watching the documentary [Kubernetes: The Documentary [PART 1]](https://youtu.be/BE77h7dmoQU?si=qohxiWDd52EpPoHP) and [Kubernetes: The Documentary [PART 2]](https://youtu.be/318elIq37PE?si=_Pjgstj7w_9OlsUf) to get context and history of the preliminary enablers for Kubernetes. 

### [Kubernetes Basics](https://kubernetes.io/docs/tutorials/kubernetes-basics/)

Kubernetes is a cluster orchestration system that enables the deployment of containerised applications on virtualised hardware or bare metal hardware. 

> Kubernetes is a production-grade, open-source platform that orchestrates the placement (scheduling) and execution of application containers within and across computer clusters.
*[kubernetes.io - Cluster Diagram. (Accessed: 04 September 2023)](https://kubernetes.io/docs/tutorials/kubernetes-basics/create-cluster/cluster-intro/)*

The diagram below illustrates the core components of a Kubernetes cluster. The Kubernetes cluster consists of one or multiple nodes that execute the application processes and control plane resource that coordinates the application activities across the nodes.


![Kubernetes Cluster](https://d33wubrfki0l68.cloudfront.net/283cc20bb49089cb2ca54d51b4ac27720c1a7902/34424/docs/tutorials/kubernetes-basics/public/images/module_01_cluster.svg)
*Image from [kubernetes.io - Cluster Diagram. (Accessed: 04 September 2023)](https://d33wubrfki0l68.cloudfront.net/283cc20bb49089cb2ca54d51b4ac27720c1a7902/34424/docs/tutorials/kubernetes-basics/public/images/module_01_cluster.svg)*


### [Using kubectl to Create a Deployment](https://kubernetes.io/docs/tutorials/kubernetes-basics/deploy-app/deploy-intro/)


A Kubernetes deployment is the recipe for running your application. The control plane will constantly monitor the state of the application and provide self-healing actions if the current application instance is unresponsive.

![ Deploying your first app on Kubernetes](https://d33wubrfki0l68.cloudfront.net/8700a7f5f0008913aa6c25a1b26c08461e4947c7/cfc2c/docs/tutorials/kubernetes-basics/public/images/module_02_first_app.svg)
*Image from [kubernetes.io - Deploying your first app on Kubernetes. (Accessed: 04 September 2023)](https://d33wubrfki0l68.cloudfront.net/8700a7f5f0008913aa6c25a1b26c08461e4947c7/cfc2c/docs/tutorials/kubernetes-basics/public/images/module_02_first_app.svg)*

`kubectl` is the CLI for Kubernetes and the CLI can be used to create a deployment of containerized applications or manage already deployed applications, fetch logs from the application, and much more.

### [Viewing Pods and Nodes](https://kubernetes.io/docs/tutorials/kubernetes-basics/explore/explore-intro/)
#### Pods

A Kubernetes Pod is an abstraction generated by a Kubernetes deployment. The Pod behaves as a logical host and is hosting one or multiple containerized applications as illustrated in the figure below.

![Pods overview](https://d33wubrfki0l68.cloudfront.net/fe03f68d8ede9815184852ca2a4fd30325e5d15a/98064/docs/tutorials/kubernetes-basics/public/images/module_03_pods.svg)
*Image from [kubernetes.io - Pods overview. (Accessed: 04 September 2023)](https://d33wubrfki0l68.cloudfront.net/fe03f68d8ede9815184852ca2a4fd30325e5d15a/98064/docs/tutorials/kubernetes-basics/public/images/module_03_pods.svg)*

#### Nodes
A Kubernetes node can be described as a worker within the Kubernetes cluster. The node is managed by the control plane and can host several different Pods as illustrated in the figure below.
![Node overview](https://d33wubrfki0l68.cloudfront.net/5cb72d407cbe2755e581b6de757e0d81760d5b86/a9df9/docs/tutorials/kubernetes-basics/public/images/module_03_nodes.svg)
*Image from [kubernetes.io - Node overview. (Accessed: 04 September 2023)](https://d33wubrfki0l68.cloudfront.net/5cb72d407cbe2755e581b6de757e0d81760d5b86/a9df9/docs/tutorials/kubernetes-basics/public/images/module_03_nodes.svg)*


### [Using a Service to Expose Your App](https://kubernetes.io/docs/tutorials/kubernetes-basics/expose/expose-intro/)


Each Kubernetes Pod has a different IP address as seen in the figure above. These IP addresses are local to the cluster and not accessible from outside the cluster. For some applications, we need to have an abstraction, which maps external traffic to the deployment (Pod) of interest. The Pods have a lifecycle and their IP address change due to rescheduling to another node.

![Services and Labels](https://d33wubrfki0l68.cloudfront.net/7a13fe12acc9ea0728460c482c67e0eb31ff5303/2c8a7/docs/tutorials/kubernetes-basics/public/images/module_04_labels.svg)
*Image from [kubernetes.io - Services and Labels. (Accessed: 04 September 2023)](https://d33wubrfki0l68.cloudfront.net/7a13fe12acc9ea0728460c482c67e0eb31ff5303/2c8a7/docs/tutorials/kubernetes-basics/public/images/module_04_labels.svg)*

A Kubernetes Service is the abstraction we need to provide a loosely coupling Pods and external traffic. There are multiple types of Services: 
- ClusterIP
- NodePort
- LoadBalancer
- ExternalName

Get full definitions here: [Overview of Kubernetes Services](https://kubernetes.io/docs/tutorials/kubernetes-basics/expose/expose-intro/)

> A Kubernetes Service is an abstraction layer which defines a logical set of Pods and enables external traffic exposure, load balancing and service discovery for those Pods. 
*[kubernetes.io - Using a Service to Expose Your App. (Accessed: 04 September 2023)](https://kubernetes.io/docs/tutorials/kubernetes-basics/expose/expose-intro/)*



## Exercises
### Exercise 01 - Setup your Kubernetes environment
```
kubectl get
```
### Exercise 02 - Deploy your "Hello World" application

Deploy a basic nginx webapp with a "Hello World" application in Kubetenetes. 
The deployed application have the following contraints:
- four replica sets
- resource limit:
    - 128Mi memory
    - 250m cpu
- resource reserves:
    - 10Mi memory
    - 10m cpu

*Hint:* Find an example online and adapt the deployment file to meet the contraints.


### Exercise 03 - Validate your deployment

- List the Pods generated by your deployment
- Validate the requested resource limit and resource reserve of your deployment

### Exercise 04 - Expose your "Hello World" application
Expose the application to localhost on port 30082 using the NodePort type. Take a screen dump of the browser

*Hint:* Find an example online and adapt the service file to reflect the keywords in the deployment file. Apply the service file and open the browser on localhost and the mentioned port.


### Exercise 05 - Scale your application 

Sometimes it my be desireble to scale your deployment up or down to match the demand of the application. Try to apply the steps below to rebalance the number of replica sets for the initial deployment.

- Document the current numbers of replicas 
- Scale manually up to 10 replicas
- Document the new numbers of replicas 
- Update deployment file to 2 replicas
- Document the final numbers of replicas


### Exercise 06 - Delete your "Hello World" application

Cleaning may sometimes be requried at the end of the day. 

-  Get the name of the deployment and service for your "Hello World" application
- Delete the services and the deployment